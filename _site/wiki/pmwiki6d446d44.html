<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
    "http://www.w3.org/TR/html40/loose.dtd">
<html>
<!-- Mirrored from kozgun.net/wiki/pmwiki.php?n=Linux.KernelDerleme?action=print by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 26 Jan 2013 19:20:18 GMT -->
<!-- Added by HTTrack -->
<!-- Mirrored from kozgun.net/wiki/pmwiki6d44.html?n=Linux.KernelDerleme?action=print by HTTrack Website Copier/3.x [XR&CO'2013], Fri, 27 Jun 2014 19:53:31 GMT -->
<meta http-equiv="content-type" content="text/html;charset=iso-8859-1" /><!-- /Added by HTTrack -->
<head>
  <title>Wiki | Linux / KernelDerleme</title>
  <link rel='stylesheet' href='pub/skins/print/print.css' type='text/css' />
  <!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
div.sourceblock {
	padding: 0.5em;
	border: 1px solid #808080;
	background-color: #F1F0ED; }
div.sourceblock div {
	font-family: monospace;
	font-size: small;
	line-height: 1; }
div.sourceblock div.head, div.sourceblock div.foot {
	font: italic medium serif;
	padding: 0.5em;
}
div.codeblock {
	padding: 0.5em;
	border: 1px solid #808080;
	background-color: #F1F0ED; }
div.codeblock pre {
	font-family: monospace;
	font-size: small;
	line-height: 1; }.editconflict { color:green; font-style:italic; 
  margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border: 2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  td.markup1 { border-bottom: 1px solid #ccf; }
  div.faq { margin-left:2em; }
  div.faq p.question { margin: 1em 0 0.75em -2em; font-weight:bold; }
  div.faq hr { margin-left: -2em; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>  <meta name='robots' content='noindex,nofollow' />

</head>
<body>
  <div id='printhead'>
    <h3>From Wiki</h3>
    <h1 class='pagename'><a href='http://kozgun.net/wiki/pmwiki.php?n=Linux'>Linux: KernelDerleme</a></h1>
  </div>
<!--PageText-->
<div id='wikitext'>
<p>Kaynak: <a class='urllink' href='http://wiki.linuxquestions.org/wiki/Compiling_a_kernel#Now_It.27s_Time_To_Install_Your_New_Kernel.7E.21' rel='nofollow'>http://wiki.linuxquestions.org/wiki/Compiling_a_kernel#Now_It.27s_Time_To_Install_Your_New_Kernel.7E.21</a>
</p><p class='vspace'></p>
<p>How to Compile a Kernel
</p><p class='vspace'></p>
<p>First and foremost, THIS (<a class='urllink' href='http://www.linux-sxs.org/upgrading/migration26.html' rel='nofollow'>http://www.linux-sxs.org/upgrading/migration26.html</a>) may pertain to you so read that first and then you can proceed and here (<a class='urllink' href='http://thomer.com/linux/migrate-to-2.6.html' rel='nofollow'>http://thomer.com/linux/migrate-to-2.6.html</a>) is a similar site. Both links are for those migrating to a 2.6 series kernel from a 2.4.x kernel.
[edit]
Obtaining and installing the Kernel Source
[edit]
Getting the kernel source
</p><p class='vspace'></p>
<p>To compile a kernel, you will need the kernel source. You can get it from kernel.org (<a class='urllink' href='http://www.kernel.org/' rel='nofollow'>http://www.kernel.org</a>). Your distribution may also already come with the kernel source, somewhere on the cd.
[edit]
Installing the kernel source
</p><p class='vspace'></p>
<p>You can install the kernel source by either installing the package that came with your distribution, or extracting the tarball you downloaded from kernel.org .
</p><p class='vspace'></p>
<p>1. Change Directory To /usr/src
</p><p class='vspace'></p>
<p>cd /usr/src			
</p><p class='vspace'></p>
<p>2. Check for symlink (ex. /usr/src/linux-&gt;/usr/src/linux-2.4.18)
</p><p class='vspace'></p>
<p>ls -alc				
</p><p class='vspace'></p>
<p>3. Double check with this command (output ex.) linux: symbolic link to linux-2.4.18-14
</p><p class='vspace'></p>
<p>file linux			         
</p><p class='vspace'></p>
<p>4. Remove the symlink
</p><p class='vspace'></p>
<p>rm linux		         
</p><p class='vspace'></p>
<p>5. Unpack the tarball (new kernel)
</p><p class='vspace'></p>
<p>tar -zxvf linux-x.x.x.tar.gz 	 
tar -jxvf linux-x.x.x.tar.bz2
</p><p class='vspace'></p>
<p>6. Make a new link to the new kernel
</p><p class='vspace'></p>
<p>ln -s /usr/src/linux-x.x.x /usr/src/linux
</p><p class='vspace'></p>
<p>7. Type this to change to the directory
</p><p class='vspace'></p>
<p>cd linux
</p><p class='vspace'></p>
<p>[edit]
Installing the tool chain and header files needed to compile
</p><p class='vspace'></p>
<p>Not all Linux distributions come with all of the components needed to build a kernel. You'll need a C compiler, make, and system header files installed before you can begin to build the kernel.
[edit]
Now Comes The Fun Part~! (compiling)
</p><p class='vspace'></p>
<p>We will now compile the kernel.
</p><p class='vspace'></p>
<p>First, clean up anything we don't need, like the current .config and other files
</p><p class='vspace'></p>
<p>make mrproper
</p><p class='vspace'></p>
<p>Do this is if you want to use your old configuration from the 2.4 kernel with the 2.6 kernel:
</p><p class='vspace'></p>
<p>cp /usr/src/linux-2.4.x/.config /usr/src/linux
</p><p class='vspace'></p>
<p>Now you configure your kernel using any one of these commands, whichever you like best:
</p><p class='vspace'></p>
<p>Basic config from terminal, a long list of questions you answer
</p><p class='vspace'></p>
<p>make config 
</p><p class='vspace'></p>
<p>For ncurses GUI in the terminal
</p><p class='vspace'></p>
<p>make menuconfig
</p><p class='vspace'></p>
<p>For X-based GUI with modular explanations (QT Based)
</p><p class='vspace'></p>
<p>make xconfig
</p><p class='vspace'></p>
<p>Same as above, but for 2.6.x kernel only (GTK Based, and might be still buggy)
</p><p class='vspace'></p>
<p>make gconfig
</p><p class='vspace'></p>
<p>Note: Don't forget to add module support and kernel support for future hardware. Do not compile your hard drive and file system type as a module. The configure program enables you to specify an enormous number of features. It is advisable to skim through all the sections to get a feel for the different things you can do. Most options are about specifying whether you want a feature [*] compiled into the kernel image, [M] compiled as a module, or [ ] not compiled at all. You can also turn off module support altogether from Loadable module support --&gt;. The kernel configuration is one LINUX program that offers lots of help--select &lt; Help &gt; on any feature. The raw help file is /usr/src/linux/Documentation/Configure.help can be also worth reading. When you're done with the config, click exit and save current configuration. Your file is now known as .config .
&gt;SKIP THE FOLLOWING IF DOING A 2.6.x KERNEL&lt;------
</p><p class='vspace'></p>
<p>make dep "Ensures dependancies such as include files are in place"
</p><p class='vspace'></p>
<p>(vi, pico, emacs) Makefile "Want A Unique Kernel Name? Edit /usr/src/linux/Makefile and change EXTRAVERSION"
</p><p class='vspace'></p>
<p>make clean "To clean your sources so they compile correctly"
&gt;START HERE IF COMPILING A 2.6.x KERNEL&lt;------
</p><p class='vspace'></p>
<p>make bzImage "To make the kernel image (compile and creates compressed image of kernel)"
</p><p class='vspace'></p>
<p>make modules "Compile your selected modules"
</p><p class='vspace'></p>
<p>make modules_install "To install newly compile modules (installs to /lib/modules/linux.x.x.x)"
[edit]
Now It's Time To Install Your New Kernel~!
</p><p class='vspace'></p>
<p class='vspace'></p><p>Remove the following links: rm -rf /boot/System.map rm -rf /boot/vmlinuz
</p><p class='vspace'></p>
<p>Then copy the newly created kernel and system.map to /boot cp /usr/src/linux/arch/i386/boot/bzImage /boot/vmlinuz-x.x.x cp /usr/src/linux/System.map /boot/System.map-x.x.x
</p><p class='vspace'></p>
<p>Make the new links: ln -s /boot/vmlinuz-x.x.x /boot/vmlinuz ln -s /boot/System.map-x.x.x /boot/System.map
</p><p class='vspace'></p>
<p>Next, if present, remove existing initrd.img file: rm -rf /boot/initrd.x.x.x.img
</p><p class='vspace'></p>
<p>And create the new one: /sbin/mkinitrd /boot/initrd-x.x.x.img x.x.x (Note: ) The last set of x.x.x is the eqivalent to your new kernel version and it looks to /lib/modules for that version.
</p><p class='vspace'></p>
<p>Use The Steps That Pertain To You
If You Use Grub Then Edit grub.conf
If You Use Lilo Then Edit lilo.conf
</p><p class='vspace'></p>
<p>remember to leave the entry to your old kernel image just in case, so modify what is in the config originally to point to the old image and make a new entry for you new image you just made ....
</p><p class='vspace'></p>
<p>&lt;-&gt; And Finally Edit Your /etc/grub.conf file &lt;-&gt; &lt;-&gt; Note some distros now use menu.lst, so if you can't find grub or lilo, then you know what to look for &lt;-&gt;
</p><p class='vspace'></p>
<p>title New Kernel :D kernel /vmlinuz-x.x.x ro root=LABEL=/
</p><p class='vspace'></p>
<pre>       initrd /initrd-x.x.x.img
</pre><p class='vspace'></p><p>(Note: ) Look at the previous parameters in the grub.conf file and note what "root=" and use what is existing.
</p><p class='vspace'></p>
<p>Exit and Save grub.conf type "/sbin/grub-install"
</p><p class='vspace'></p>
<p>AND REBOOT!!!
</p><p class='vspace'></p>
<p>&lt;-&gt; And Finally Edit Your /etc/lilo.conf file &lt;-&gt; image = /boot/vmlinuz-x.x.x
</p><p class='vspace'></p>
<pre>          label = New Kernel :D
          root = /dev/hdx
          read-only
</pre><p class='vspace'></p><p>(Note: ) look at the previous parameters in the lilo.conf file and note what "root =" and use what exists.
</p><p class='vspace'></p>
<p>Exit and Save lilo.conf type "/sbin/lilo"
</p><p class='vspace'></p>
<p>AND REBOOT!!!
</p><p class='vspace'></p>
<p class='vspace'></p><p>/EDIT By request: the instructions on how to apply patches to your kernel. END EDIT/
</p><p class='vspace'></p>
<p>read this (<a class='urllink' href='http://www.linuxhq.com/patch-howto.html' rel='nofollow'>http://www.linuxhq.com/patch-howto.html</a>) or look below ...
</p><p class='vspace'></p>
<p>This step comes after untarring your kernel source. When you download the patch, place it in the folder where you untarred your new kernel. Then type:
patch -E -p1 &lt; sound_patch
Purely an example and you would type whatever the file name is in replace of sound_patch.
</p><p class='vspace'></p>
<p class='vspace'></p><p>Regarding having alternative boot options, this is no problem. The stuff above that I tell you to add to your lilo or grub file above could just be appended to the file, and you could just add ".old" to the title of your original kernel name for you will know the difference. Whether it's grub or lilo, add "read-only" to the end of the original entries in the lilo.conf, or grub.conf, file.
[edit]
Special notes for Debian Users
</p><p class='vspace'></p>
<p>Debian has some utilities to make your life a little easier. The kernel-package set of utilities allows to to create your own kernel package. For most users, this just means that your kernel shows up like all other debian packages. However, if you have multiple machines running the same kernel, it allows an easy way to install it on all of them. So let's get started.
</p><p class='vspace'></p>
<p>First, make sure you have the kernel-package tools. You can install them with the command apt-get install kernel-package.
</p><p class='vspace'></p>
<p>The initial steps are the same, make clean, make menuconfig (or xconfig etc...). Once your kernel is configured, type make-kpkg kernel_image and it will make your kernel.
</p><p class='vspace'></p>
<p>Assuming the compile was successful, it will create a .deb in /usr/src which you can then install by typing dpkg -i kernel-package-filename, follow the instructions and reboot.
</p><p class='vspace'></p>
<p>You can also create a custom kernel name (to avoid overwriting other kernels you have made) by typing something like: make-kpkg kernel_image --revision=custom.1.
</p><p class='vspace'></p>
<p>This is just a quick review of the commands you need, for more information check out this guide (<a class='urllink' href='http://newbiedoc.sourceforge.net/tutorials/kernel-pkg/index-kernel-pkg.html' rel='nofollow'>http://newbiedoc.sourceforge.net/tutorials/kernel-pkg/index-kernel-pkg.html</a>) to compiling using the kernel package program.
</p>
</div>

  <div id='printfoot'>
    <div class='from'>Retrieved from http://kozgun.net/wiki/pmwiki.php?n=Linux.KernelDerleme</div>
    <div class='lastmod'>Page last modified on March 23, 2006, at 11:11 PM</div></div>
</body>

<!-- Mirrored from kozgun.net/wiki/pmwiki.php?n=Linux.KernelDerleme?action=print by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 26 Jan 2013 19:20:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=iso-8859-1" /><!-- /Added by HTTrack -->

<!-- Mirrored from kozgun.net/wiki/pmwiki6d44.html?n=Linux.KernelDerleme?action=print by HTTrack Website Copier/3.x [XR&CO'2013], Fri, 27 Jun 2014 19:53:31 GMT -->
</html>
